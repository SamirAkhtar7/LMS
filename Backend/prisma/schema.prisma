// =====================
// Prisma Schema: Loan Management System
// =====================
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma-client"
}

datasource db {
  provider = "mysql"
  // Connection URL moved to prisma.config.ts per Prisma 7+ requirements
}

// =================================USERS=====================================

model User {
  id            String   @id @default(cuid())
  fullName      String
  email         String   @unique
  password      String
  role          Role
  contactNumber String
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  profile  UserProfile?
  admin    Admin?
  partner  Partner?
  employee Employee?
  
  leadsAssignedTo Leads[] @relation("LeadAssignedTo")
  leadsAssignedBy Leads[] @relation("LeadAssignedBy")

}

model UserProfile {
  id             String   @id @default(cuid())
  userId         String   @unique
  dob            DateTime
  gender         String
  meritalStatus  String
  educationLevel String
  occupation     String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])
}

model Admin {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])
}

model Employee {
  id              String        @id @default(cuid())
  userId          String        @unique
  employeeId      String        @unique
  userName String @unique
  mobileNumber    String
  atlMobileNumber String
  dob             DateTime
  designation     String
  gender          Gender
  maritalStatus   MaritalStatus

  // Contact & address
  address String
  city    String
  state   String
  pinCode String

  // Emergency
  emergencyContact      String
  emergencyRelationship Relationship

  // Professional
  department         String
  dateOfJoining      DateTime
  experience         String
  reportingManagerId String
  // reportingManager   Employee? @relation("ManagerEmployees", fields: [reportingManagerId], references: [id])
  // subordinates       Employee[] @relation("ManagerEmployees")
  workLocation       WorkLocation
  salary             Float

  // Optional username if separate from `User`

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])
}

model Partner {
  id               String   @id @default(cuid())
  userId           String   @unique
  userName         String   @unique
  partnerType      String?
  experience       String?
  targetArea       String?
  totalReferrals   Int?     @default(0)
  activeReferrals  Int?     @default(0)
  commissionEarned Float?   @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])
}

model Leads {
  id            String    @id @default(cuid())
  fullName      String
  contactNumber String
  email         String
  dob           DateTime
  gender        Gender
  loanAmount    Float
  typeOfLoan    LonenType
  city          String
  state         String
  pinCode       String
  address       String

  assignedTo String?  @unique
  assignedBy String?  @unique
  status     LeadStatus   @default(PENDING)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt


  // Relations  assignedToUser User? @relation("LeadAssignedTo", fields: [assignedTo], references
  assignedToUser User? @relation("LeadAssignedTo", fields: [assignedTo], references: [id])
  assignedByUser User? @relation("LeadAssignedBy", fields: [assignedBy], references: [id])
}

// =================================ENUMS=====================================

enum Role {
  ADMIN
  EMPLOYEE
  PARTNER
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum Relationship {
  FATHER
  MOTHER
  SPOUSE
  SIBLING
  FRIEND
  OTHER
}

enum WorkLocation {
  OFFICE
  REMOTE
  HYBRID
}

enum LonenType {
  PERSONAL
  HOME
  EDUCATION
  BUSINESS
}

enum LeadStatus {
 CONTACTED
  INTERESTED
  APPLICATION_IN_PROGRESS
  APPLICATION_SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  FUNDED
  CLOSED
  DROPPED
  PENDING
}